-- Seed 1871377166

actions = {{id = "BOMB"},{id = "LIGHT_BULLET"},{id = "LIGHT_BULLET_TRIGGER"},{id = "LIGHT_BULLET_TRIGGER_2"},{id = "LIGHT_BULLET_TIMER"},{id = "BULLET"},{id = "BULLET_TRIGGER"},{id = "BULLET_TIMER"},{id = "HEAVY_BULLET"},{id = "HEAVY_BULLET_TRIGGER"},{id = "HEAVY_BULLET_TIMER"},{id = "AIR_BULLET"},{id = "SLOW_BULLET"},{id = "SLOW_BULLET_TRIGGER"},{id = "SLOW_BULLET_TIMER"},{id = "BLACK_HOLE"},{id = "BLACK_HOLE_DEATH_TRIGGER"},{id = "BLACK_HOLE_BIG"},{id = "BLACK_HOLE_GIGA"},{id = "TENTACLE_PORTAL"},{id = "SPITTER"},{id = "SPITTER_TIMER"},{id = "SPITTER_TIER_2"},{id = "SPITTER_TIER_2_TIMER"},{id = "SPITTER_TIER_3"},{id = "SPITTER_TIER_3_TIMER"},{id = "BUBBLESHOT"},{id = "BUBBLESHOT_TRIGGER"},{id = "DISC_BULLET"},{id = "DISC_BULLET_BIG"},{id = "DISC_BULLET_BIGGER"},{id = "BOUNCY_ORB"},{id = "BOUNCY_ORB_TIMER"},{id = "RUBBER_BALL"},{id = "ARROW"},{id = "POLLEN"},{id = "LANCE"},{id = "ROCKET"},{id = "ROCKET_TIER_2"},{id = "ROCKET_TIER_3"},{id = "GRENADE"},{id = "GRENADE_TRIGGER"},{id = "GRENADE_TIER_2"},{id = "GRENADE_TIER_3"},{id = "GRENADE_ANTI"},{id = "GRENADE_LARGE"},{id = "MINE"},{id = "MINE_DEATH_TRIGGER"},{id = "PIPE_BOMB"},{id = "PIPE_BOMB_DEATH_TRIGGER"},{id = "EXPLODING_DEER"},{id = "EXPLODING_DUCKS"},{id = "WORM_SHOT"},{id = "BOMB_DETONATOR"},{id = "LASER"},{id = "MEGALASER"},{id = "LIGHTNING"},{id = "BALL_LIGHTNING"},{id = "LASER_EMITTER"},{id = "LASER_EMITTER_FOUR"},{id = "LASER_EMITTER_CUTTER"},{id = "DIGGER"},{id = "POWERDIGGER"},{id = "CHAINSAW"},{id = "LUMINOUS_DRILL"},{id = "LASER_LUMINOUS_DRILL"},{id = "TENTACLE"},{id = "TENTACLE_TIMER"},{id = "HEAL_BULLET"},{id = "SPIRAL_SHOT"},{id = "MAGIC_SHIELD"},{id = "BIG_MAGIC_SHIELD"},{id = "CHAIN_BOLT"},{id = "FIREBALL"},{id = "METEOR"},{id = "FLAMETHROWER"},{id = "ICEBALL"},{id = "SLIMEBALL"},{id = "DARKFLAME"},{id = "MISSILE"},{id = "FUNKY_SPELL"},{id = "PEBBLE"},{id = "DYNAMITE"},{id = "GLITTER_BOMB"},{id = "BUCKSHOT"},{id = "FREEZING_GAZE"},{id = "GLOWING_BOLT"},{id = "SPORE_POD"},{id = "GLUE_SHOT"},{id = "BOMB_HOLY"},{id = "BOMB_HOLY_GIGA"},{id = "PROPANE_TANK"},{id = "BOMB_CART"},{id = "CURSED_ORB"},{id = "EXPANDING_ORB"},{id = "CRUMBLING_EARTH"},{id = "SUMMON_ROCK"},{id = "SUMMON_EGG"},{id = "SUMMON_HOLLOW_EGG"},{id = "TNTBOX"},{id = "TNTBOX_BIG"},{id = "SWARM_FLY"},{id = "SWARM_FIREBUG"},{id = "SWARM_WASP"},{id = "FRIEND_FLY"},{id = "ACIDSHOT"},{id = "THUNDERBALL"},{id = "FIREBOMB"},{id = "SOILBALL"},{id = "DEATH_CROSS"},{id = "DEATH_CROSS_BIG"},{id = "INFESTATION"},{id = "WALL_HORIZONTAL"},{id = "WALL_VERTICAL"},{id = "WALL_SQUARE"},{id = "TEMPORARY_WALL"},{id = "TEMPORARY_PLATFORM"},{id = "PURPLE_EXPLOSION_FIELD"},{id = "DELAYED_SPELL"},{id = "LONG_DISTANCE_CAST"},{id = "TELEPORT_CAST"},{id = "SUPER_TELEPORT_CAST"},{id = "MIST_RADIOACTIVE"},{id = "MIST_ALCOHOL"},{id = "MIST_SLIME"},{id = "MIST_BLOOD"},{id = "CIRCLE_FIRE"},{id = "CIRCLE_ACID"},{id = "CIRCLE_OIL"},{id = "CIRCLE_WATER"},{id = "MATERIAL_WATER"},{id = "MATERIAL_OIL"},{id = "MATERIAL_BLOOD"},{id = "MATERIAL_ACID"},{id = "MATERIAL_CEMENT"},{id = "TELEPORT_PROJECTILE"},{id = "TELEPORT_PROJECTILE_SHORT"},{id = "TELEPORT_PROJECTILE_STATIC"},{id = "SWAPPER_PROJECTILE"},{id = "TELEPORT_PROJECTILE_CLOSER"},{id = "NUKE"},{id = "NUKE_GIGA"},{id = "FIREWORK"},{id = "SUMMON_WANDGHOST"},{id = "TOUCH_GOLD"},{id = "TOUCH_WATER"},{id = "TOUCH_OIL"},{id = "TOUCH_ALCOHOL"},{id = "TOUCH_BLOOD"},{id = "TOUCH_SMOKE"},{id = "DESTRUCTION"},{id = "BURST_2"},{id = "BURST_3"},{id = "BURST_4"},{id = "BURST_8"},{id = "BURST_X"},{id = "SCATTER_2"},{id = "SCATTER_3"},{id = "SCATTER_4"},{id = "I_SHAPE"},{id = "Y_SHAPE"},{id = "T_SHAPE"},{id = "W_SHAPE"},{id = "CIRCLE_SHAPE"},{id = "PENTAGRAM_SHAPE"},{id = "SPREAD_REDUCE"},{id = "HEAVY_SPREAD"},{id = "RECHARGE"},{id = "LIFETIME"},{id = "LIFETIME_DOWN"},{id = "NOLLA"},{id = "SLOW_BUT_STEADY"},{id = "EXPLOSION_REMOVE"},{id = "EXPLOSION_TINY"},{id = "LASER_EMITTER_WIDER"},{id = "MANA_REDUCE"},{id = "BLOOD_MAGIC"},{id = "MONEY_MAGIC"},{id = "BLOOD_TO_POWER"},{id = "DUPLICATE"},{id = "QUANTUM_SPLIT"},{id = "GRAVITY"},{id = "GRAVITY_ANTI"},{id = "SINEWAVE"},{id = "CHAOTIC_ARC"},{id = "PINGPONG_PATH"},{id = "AVOIDING_ARC"},{id = "FLOATING_ARC"},{id = "FLY_DOWNWARDS"},{id = "FLY_UPWARDS"},{id = "HORIZONTAL_ARC"},{id = "LINE_ARC"},{id = "ORBIT_SHOT"},{id = "SPIRALING_SHOT"},{id = "PHASING_ARC"},{id = "BOUNCE"},{id = "REMOVE_BOUNCE"},{id = "HOMING"},{id = "HOMING_SHORT"},{id = "HOMING_ROTATE"},{id = "HOMING_SHOOTER"},{id = "AUTOAIM"},{id = "HOMING_ACCELERATING"},{id = "HOMING_CURSOR"},{id = "HOMING_AREA"},{id = "PIERCING_SHOT"},{id = "CLIPPING_SHOT"},{id = "DAMAGE"},{id = "DAMAGE_RANDOM"},{id = "BLOODLUST"},{id = "DAMAGE_FOREVER"},{id = "CRITICAL_HIT"},{id = "AREA_DAMAGE"},{id = "SPELLS_TO_POWER"},{id = "ESSENCE_TO_POWER"},{id = "HEAVY_SHOT"},{id = "LIGHT_SHOT"},{id = "KNOCKBACK"},{id = "RECOIL"},{id = "RECOIL_DAMPER"},{id = "SPEED"},{id = "ACCELERATING_SHOT"},{id = "DECELERATING_SHOT"},{id = "EXPLOSIVE_PROJECTILE"},{id = "WATER_TO_POISON"},{id = "BLOOD_TO_ACID"},{id = "LAVA_TO_BLOOD"},{id = "LIQUID_TO_EXPLOSION"},{id = "TOXIC_TO_ACID"},{id = "STATIC_TO_SAND"},{id = "TRANSMUTATION"},{id = "RANDOM_EXPLOSION"},{id = "NECROMANCY"},{id = "LIGHT"},{id = "EXPLOSION"},{id = "EXPLOSION_LIGHT"},{id = "FIRE_BLAST"},{id = "POISON_BLAST"},{id = "ALCOHOL_BLAST"},{id = "THUNDER_BLAST"},{id = "BERSERK_FIELD"},{id = "POLYMORPH_FIELD"},{id = "CHAOS_POLYMORPH_FIELD"},{id = "ELECTROCUTION_FIELD"},{id = "FREEZE_FIELD"},{id = "REGENERATION_FIELD"},{id = "TELEPORTATION_FIELD"},{id = "LEVITATION_FIELD"},{id = "SHIELD_FIELD"},{id = "PROJECTILE_TRANSMUTATION_FIELD"},{id = "PROJECTILE_THUNDER_FIELD"},{id = "PROJECTILE_GRAVITY_FIELD"},{id = "VACUUM_POWDER"},{id = "VACUUM_LIQUID"},{id = "VACUUM_ENTITIES"},{id = "SEA_LAVA"},{id = "SEA_ALCOHOL"},{id = "SEA_OIL"},{id = "SEA_WATER"},{id = "SEA_ACID"},{id = "SEA_ACID_GAS"},{id = "CLOUD_WATER"},{id = "CLOUD_OIL"},{id = "CLOUD_BLOOD"},{id = "CLOUD_ACID"},{id = "CLOUD_THUNDER"},{id = "ELECTRIC_CHARGE"},{id = "MATTER_EATER"},{id = "FREEZE"},{id = "HITFX_BURNING_CRITICAL_HIT"},{id = "HITFX_CRITICAL_WATER"},{id = "HITFX_CRITICAL_OIL"},{id = "HITFX_CRITICAL_BLOOD"},{id = "HITFX_TOXIC_CHARM"},{id = "HITFX_EXPLOSION_SLIME"},{id = "HITFX_EXPLOSION_SLIME_GIGA"},{id = "HITFX_EXPLOSION_ALCOHOL"},{id = "HITFX_EXPLOSION_ALCOHOL_GIGA"},{id = "HITFX_PETRIFY"},{id = "ROCKET_DOWNWARDS"},{id = "ROCKET_OCTAGON"},{id = "FIZZLE"},{id = "BOUNCE_EXPLOSION"},{id = "BOUNCE_SPARK"},{id = "BOUNCE_LASER"},{id = "BOUNCE_LASER_EMITTER"},{id = "BOUNCE_LARPA"},{id = "FIREBALL_RAY"},{id = "LIGHTNING_RAY"},{id = "TENTACLE_RAY"},{id = "LASER_EMITTER_RAY"},{id = "FIREBALL_RAY_LINE"},{id = "FIREBALL_RAY_ENEMY"},{id = "LIGHTNING_RAY_ENEMY"},{id = "TENTACLE_RAY_ENEMY"},{id = "GRAVITY_FIELD_ENEMY"},{id = "CURSE"},{id = "CURSE_WITHER_PROJECTILE"},{id = "CURSE_WITHER_EXPLOSION"},{id = "CURSE_WITHER_MELEE"},{id = "CURSE_WITHER_ELECTRICITY"},{id = "ORBIT_DISCS"},{id = "ORBIT_FIREBALLS"},{id = "ORBIT_NUKES"},{id = "ORBIT_LASERS"},{id = "ORBIT_LARPA"},{id = "CHAIN_SHOT"},{id = "ARC_ELECTRIC"},{id = "ARC_FIRE"},{id = "ARC_GUNPOWDER"},{id = "ARC_POISON"},{id = "CRUMBLING_EARTH_PROJECTILE"},{id = "X_RAY"},{id = "UNSTABLE_GUNPOWDER"},{id = "ACID_TRAIL"},{id = "POISON_TRAIL"},{id = "OIL_TRAIL"},{id = "WATER_TRAIL"},{id = "GUNPOWDER_TRAIL"},{id = "FIRE_TRAIL"},{id = "BURN_TRAIL"},{id = "TORCH"},{id = "TORCH_ELECTRIC"},{id = "ENERGY_SHIELD"},{id = "ENERGY_SHIELD_SECTOR"},{id = "ENERGY_SHIELD_SHOT"},{id = "TINY_GHOST"},{id = "OCARINA_A"},{id = "OCARINA_B"},{id = "OCARINA_C"},{id = "OCARINA_D"},{id = "OCARINA_E"},{id = "OCARINA_F"},{id = "OCARINA_GSHARP"},{id = "OCARINA_A2"},{id = "KANTELE_A"},{id = "KANTELE_D"},{id = "KANTELE_DIS"},{id = "KANTELE_E"},{id = "KANTELE_G"},{id = "RANDOM_SPELL"},{id = "RANDOM_PROJECTILE"},{id = "RANDOM_MODIFIER"},{id = "RANDOM_STATIC_PROJECTILE"},{id = "DRAW_RANDOM"},{id = "DRAW_RANDOM_X3"},{id = "DRAW_3_RANDOM"},{id = "ALL_NUKES"},{id = "ALL_DISCS"},{id = "ALL_ROCKETS"},{id = "ALL_DEATHCROSSES"},{id = "ALL_BLACKHOLES"},{id = "ALL_ACID"},{id = "ALL_SPELLS"},{id = "SUMMON_PORTAL"},{id = "ADD_TRIGGER"},{id = "ADD_TIMER"},{id = "ADD_DEATH_TRIGGER"},{id = "LARPA_CHAOS"},{id = "LARPA_DOWNWARDS"},{id = "LARPA_UPWARDS"},{id = "LARPA_CHAOS_2"},{id = "LARPA_DEATH"},{id = "ALPHA"},{id = "GAMMA"},{id = "TAU"},{id = "OMEGA"},{id = "MU"},{id = "PHI"},{id = "SIGMA"},{id = "ZETA"},{id = "DIVIDE_2"},{id = "DIVIDE_3"},{id = "DIVIDE_4"},{id = "DIVIDE_10"},{id = "METEOR_RAIN"},{id = "WORM_RAIN"},{id = "RESET"},{id = "IF_ENEMY"},{id = "IF_PROJECTILE"},{id = "IF_HP"},{id = "IF_HALF"},{id = "IF_END"},{id = "IF_ELSE"},{id = "COLOUR_RED"},{id = "COLOUR_ORANGE"},{id = "COLOUR_GREEN"},{id = "COLOUR_YELLOW"},{id = "COLOUR_PURPLE"},{id = "COLOUR_BLUE"},{id = "COLOUR_RAINBOW"},{id = "COLOUR_INVIS"},{id = "RAINBOW_TRAIL"},}

x = 0
y = 0
iters = 4000000
results = {}

for level=0,10 do
for i=0,iters do
  res = GetRandomAction(x, y, level, 0)
  x = x+1
  y = y+1
  if results[res] == nil then
    results[res] = 1
  else
    results[res] = results[res] + 1
  end
end
end

for key, value in pairs(actions) do
  if results[value.id] == nil then
-- print([[{id = "]]..value.id..[["},])
    print(key - 1, "id = \"", value.id, "\"")
  end
end


SetRandomSeed(1, 1);
print(RandomDistribution(2, 7, 4, 4)) -- 3
print(RandomDistribution(2, 7, 4, 4)) -- 3
print(RandomDistribution(2, 7, 4, 4)) -- 4
print(RandomDistributionf(0.8, 1.2, 1, 6)) -- 0.98004007339478
print(RandomDistributionf(0.8, 1.2, 1, 6)) -- 1.032301068306
print(RandomDistributionf(0.8, 1.2, 1, 6)) -- 0.91669422388077
print(Random(1, 3)) -- 2
print(Random(0, 1)) -- 0
print(Random(0, 100)) -- 44
print(Random()) -- 0.13491553068161
for i = 0,9999 do
  Random()
end
print(Random()) -- 0.27106264233589
-- print (dump(results))
-- GAME> 18 id = " BLACK_HOLE_GIGA "
-- GAME> 90 id = " BOMB_HOLY_GIGA "
-- GAME> 141 id = " NUKE_GIGA "
-- GAME> 171 id = " SLOW_BUT_STEADY "
-- GAME> 255 id = " SEA_LAVA "
-- GAME> 327 id = " OCARINA_A "
-- GAME> 328 id = " OCARINA_B "
-- GAME> 329 id = " OCARINA_C "
-- GAME> 330 id = " OCARINA_D "
-- GAME> 331 id = " OCARINA_E "
-- GAME> 332 id = " OCARINA_F "
-- GAME> 333 id = " OCARINA_GSHARP "
-- GAME> 334 id = " OCARINA_A2 "
-- GAME> 335 id = " KANTELE_A "
-- GAME> 336 id = " KANTELE_D "
-- GAME> 337 id = " KANTELE_DIS "
-- GAME> 338 id = " KANTELE_E "
-- GAME> 339 id = " KANTELE_G "
-- GAME> 347 id = " ALL_NUKES "
-- GAME> 348 id = " ALL_DISCS "
-- GAME> 349 id = " ALL_ROCKETS "
-- GAME> 350 id = " ALL_DEATHCROSSES "
-- GAME> 351 id = " ALL_BLACKHOLES "
-- GAME> 352 id = " ALL_ACID "
-- GAME> 354 id = " SUMMON_PORTAL "
-- GAME> 361 id = " LARPA_CHAOS_2 "
-- GAME> 374 id = " DIVIDE_10 "
-- GAME> 378 id = " IF_ENEMY "
-- GAME> 379 id = " IF_PROJECTILE "
-- GAME> 380 id = " IF_HP "
-- GAME> 381 id = " IF_HALF "
-- GAME> 382 id = " IF_END "
-- GAME> 383 id = " IF_ELSE "
-- GAME> 384 id = " COLOUR_RED "
-- GAME> 385 id = " COLOUR_ORANGE "
-- GAME> 386 id = " COLOUR_GREEN "
-- GAME> 387 id = " COLOUR_YELLOW "
-- GAME> 388 id = " COLOUR_PURPLE "
-- GAME> 389 id = " COLOUR_BLUE "
-- GAME> 390 id = " COLOUR_RAINBOW "
-- GAME> 391 id = " COLOUR_INVIS "
-- GAME> 392 id = " RAINBOW_TRAIL "

print(GetRandomActionWithType(0, 0, ACTION_TYPE_PROJECTILE, 0)) -- LASER_EMITTER_WIDER
print(GetRandomActionWithType(1, 1, ACTION_TYPE_PROJECTILE, 0)) -- GRENADE_TRIGGER
print(GetRandomActionWithType(2, 2, ACTION_TYPE_PROJECTILE, 0)) -- BOMB
print(GetRandomActionWithType(3, 3, ACTION_TYPE_PROJECTILE, 0)) -- MANA_REDUCE


print(GetRandomActionWithType(0, 0, 4, 1)) -- HEAVY_BULLET_TIMER
print(GetRandomActionWithType(1, 1, 4, 1)) -- DAMAGE
print(GetRandomActionWithType(2, 2, 4, 1)) -- DEATH_CROSS
print(GetRandomActionWithType(3, 3, 4, 1)) -- HEAVY_BULLET_TIMER


print(GetRandomActionWithType(0, 0, 4, 2)) -- WALL_VERTICAL
print(GetRandomActionWithType(1, 1, 4, 2)) -- ADD_TIMER
print(GetRandomActionWithType(2, 2, 4, 2)) -- GLOWING_BOLT
print(GetRandomActionWithType(3, 3, 4, 2)) -- PHASING_ARC

print(GetRandomActionWithType(0, 0, 4, 3)) -- QUANTUM_SPLIT
print(GetRandomActionWithType(1, 1, 4, 3)) -- BOUNCE
print(GetRandomActionWithType(2, 2, 4, 3)) -- CLIPPING_SHOT
print(GetRandomActionWithType(3, 3, 4, 3)) -- BLOODLUST


dofile_once('data/scripts/gun/procedural/gun_procedural.lua')

function dump(o)
  if type(o) == 'table' then
     local s = '{ '
     for k,v in pairs(o) do
        if type(k) ~= 'number' then k = '"'..k..'"' end
        s = s .. '['..k..'] = ' .. dump(v) .. ','
     end
     return s .. '} '
  else
     return tostring(o)
  end
end


SetRandomSeed( -225, 2931 )

-- { ["deck_capacity"] = 9,["reload_time"] = 30,["mana_charge_speed"] = 51,["is_rare"] = 0,["force_unshuffle"] = 0,["speed_multiplier"] = 0.80152463912964,["shuffle_deck_when_empty"] = 1,["mana_max"] = 170,["actions_per_round"] = 1,["prob_draw_many"] = 0.15,["prob_unshuffle"] = 0.1,["spread_degrees"] = 3,["fire_rate_wait"] = 13,["cost"] = 0,}
-- SetRandomSeed( 123.5, 1515 )
-- print(get_gun_data( 40, 6, false))
-- { ["deck_capacity"] = 2.88,["reload_time"] = 54,["mana_charge_speed"] = 322,["is_rare"] = 0,["force_unshuffle"] = 1,["speed_multiplier"] = 0.93877726793289,["shuffle_deck_when_empty"] = 0,["mana_max"] = 950,["actions_per_round"] = 1,["prob_draw_many"] = 0.15,["prob_unshuffle"] = 0.1,["spread_degrees"] = 2,["fire_rate_wait"] = 8,["cost"] = 0,}
cards = {}
cards_permanent = nil

EntityGetTransform = function (entity_id)
  return 	-225, 2931
end

AddGunActionPermanent = function (eid, card)
  cards_permanent = card
end

AddGunAction = function(eid, card )
  cards[#cards + 1] = card
end

function wand_add_random_cards( gun, entity_id, level )

	local is_rare = gun["is_rare"]
	local x, y = EntityGetTransform( entity_id )
  print(x, y)

	-- stuff in the gun
	local good_cards = 5
	if( Random(0,100) < 7 ) then good_cards = Random(20,50) end

	if( is_rare == 1 ) then
		good_cards = good_cards * 2
	end

	if( level == nil ) then level = 1 end
	level = tonumber( level )

	local orig_level = level
	level = level - 1
	local deck_capacity = gun["deck_capacity"]
	local actions_per_round = gun["actions_per_round"]
	local card_count = Random( 1, 3 )
	local bullet_card = GetRandomActionWithType( x, y, level, ACTION_TYPE_PROJECTILE, 0 )
  print( x, y, level, ACTION_TYPE_PROJECTILE, 0 )
	local card = ""
	local random_bullets = 0
	local good_card_count = 0

	if( Random(0,100) < 50 and card_count < 3 ) then card_count = card_count + 1 end

	if( Random(0,100) < 10 or is_rare == 1 ) then
		card_count = card_count + Random( 1, 2 )
	end

	good_cards = Random( 5, 45 )
	card_count = Random( 0.51 * deck_capacity, deck_capacity )
	print(card_count, 1, deck_capacity-1)
	card_count = clamp( card_count, 1, deck_capacity-1 )
	print("card_count", card_count)
	-- card count is in between 1 and 6

	if( Random(0,100) < (orig_level*10)-5 ) then
		random_bullets = 1
	end

	if( Random( 0, 100 ) < 4 or is_rare == 1 ) then
		local p = Random(0,100)
		if( p < 77 ) then
			card = GetRandomActionWithType( x, y, level+1, ACTION_TYPE_MODIFIER, 666 )
		--[[
		Arvi (9.12.2020): DRAW_MANY cards were causing oddities as always casts, so testing a different set of always_cast cards
		elseif( p < 94 ) then
			card = GetRandomActionWithType( x, y, level+1, ACTION_TYPE_DRAW_MANY, 666 )
			good_card_count = good_card_count + 1
		]]--
		elseif ( p < 85 ) then
			card = GetRandomActionWithType( x, y, level+1, ACTION_TYPE_MODIFIER, 666 )
			good_card_count = good_card_count + 1
		elseif ( p < 93 ) then
			card = GetRandomActionWithType( x, y, level+1, ACTION_TYPE_STATIC_PROJECTILE, 666 )
		else
			card = GetRandomActionWithType( x, y, level+1, ACTION_TYPE_PROJECTILE, 666 )
		end
		AddGunActionPermanent( entity_id, card )
	end

	-- --------------- CARDS ---
	-- TODO: tweak the %
	if( Random( 0, 100 ) < 50 ) then

		-- more structured placement
		-- DRAW_MANY + MOD + BULLET

		-- local bullet_card = GetRandomActionWithType( x, y, level, ACTION_TYPE_PROJECTILE, 0 )
		local extra_level = level
		while( Random( 1, 10 ) == 10 ) do
			extra_level = extra_level + 1
			bullet_card = GetRandomActionWithType( x, y, extra_level, ACTION_TYPE_PROJECTILE, 0 )
		end

		if( card_count < 3 ) then
			if( card_count > 1 and Random( 0, 100 ) < 20 ) then
				card = GetRandomActionWithType( x, y, level, ACTION_TYPE_MODIFIER, 2 )
				AddGunAction( entity_id, card )
				card_count = card_count - 1
			end

			for i=1,card_count do
				AddGunAction( entity_id, bullet_card )
			end
		else
			-- DRAW_MANY + MOD
			if( Random( 0, 100 ) < 40 ) then
				card = GetRandomActionWithType( x, y, level, ACTION_TYPE_DRAW_MANY, 1 )
				AddGunAction( entity_id, card )
				card_count = card_count - 1
			end

			-- add another DRAW_MANY
			if( card_count > 3 and Random( 0, 100 ) < 40 ) then
				card = GetRandomActionWithType( x, y, level, ACTION_TYPE_DRAW_MANY, 1 )
				AddGunAction( entity_id, card )
				card_count = card_count - 1
			end

			if( Random( 0, 100 ) < 80 ) then
				card = GetRandomActionWithType( x, y, level, ACTION_TYPE_MODIFIER, 2 )
				AddGunAction( entity_id, card )
				card_count = card_count - 1
			end


			for i=1,card_count do
				AddGunAction( entity_id, bullet_card )
			end
		end
	else
		for i=1,card_count do
			if( Random(0,100) < good_cards and card_count > 2 ) then
				-- if actions_per_round == 1 and the first good card, then make sure it's a draw x
				if( good_card_count == 0 and actions_per_round == 1 ) then
					card = GetRandomActionWithType( x, y, level, ACTION_TYPE_DRAW_MANY, i )
					good_card_count = good_card_count + 1
				else
					if( Random(0,100) < 83 ) then
						card = GetRandomActionWithType( x, y, level, ACTION_TYPE_MODIFIER, i )
					else
						card = GetRandomActionWithType( x, y, level, ACTION_TYPE_DRAW_MANY, i )
					end
				end

				AddGunAction( entity_id, card )
			else
				AddGunAction( entity_id, bullet_card )
				if( random_bullets == 1 ) then
					bullet_card = GetRandomActionWithType( x, y, level, ACTION_TYPE_PROJECTILE, i )
				end
			end
		end
	end
end

gun = get_gun_data( 25, 1, true)
print(dump(gun))
wand_add_random_cards(gun, nil, 1)
print(dump(cards))
print(dump(cards_permanent))

--

SetWorldSeed(266197553)


function rand_card (x, y)
	local good_cards = { "DAMAGE", "CRITICAL_HIT", "HOMING", "SPEED", "ACID_TRAIL", "SINEWAVE" }

-- "FREEZE", "MATTER_EATER", "ELECTRIC_CHARGE"
	SetRandomSeed( x, y )

	local card = good_cards[ Random( 1, #good_cards ) ]

	local r = Random( 1, 100 )
	local level = 6

	if( r <= 50 ) then
		local p = Random(1,100)

		--[[
		Arvi (9.12.2020): DRAW_MANY cards were causing odd behaviour as always casts, so testing a different set of always_cast cards
		if( p <= 80 ) then
			card = GetRandomActionWithType( x, y, level, ACTION_TYPE_MODIFIER, 666 )
		elseif( p <= 95 ) then
			card = GetRandomActionWithType( x, y, level, ACTION_TYPE_DRAW_MANY, 666 )
		else
			card = GetRandomActionWithType( x, y, level, ACTION_TYPE_PROJECTILE, 666 )
		end
		]]--

		if( p <= 86 ) then
			card = GetRandomActionWithType( x, y, level, ACTION_TYPE_MODIFIER, 666 )
		elseif( p <= 93 ) then
			card = GetRandomActionWithType( x, y, level, ACTION_TYPE_STATIC_PROJECTILE, 666 )
		elseif ( p < 100 ) then
			card = GetRandomActionWithType( x, y, level, ACTION_TYPE_PROJECTILE, 666 )
		else
			card = GetRandomActionWithType( x, y, level, ACTION_TYPE_UTILITY, 666 )
		end
	end

	print("---")
	print(card)
	print("---")
end

for level = 0,6 do
	for i = 0,2 do
		rand_card(i, level)
	end
	print()
end
